<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Flota - Sistema Integral</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .fuera-servicio { background-color: #ffe6e6; color: #dc3545; font-weight: bold; }
        .badge-falla { margin-right: 5px; font-size: 0.9em; }
        .table-responsive { max-height: 500px; overflow-y: auto; }
        tr { transition: all 0.3s ease; }
        tr:hover { background-color: #e9ecef; }
        
        /* Estilos Login */
        #pantalla-login {
            height: 100vh; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);
        }
        #pantalla-app { display: none; }
        .card-login { width: 100%; max-width: 400px; border: none; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .card-login .btn { border-radius: 10px; transition: transform 0.2s; }
        .card-login .btn:hover { transform: translateY(-3px); }

        /* Mejoras est√©ticas generales */
        .card { border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card-header { border-top-left-radius: 15px; border-top-right-radius: 15px; }
        .btn { border-radius: 8px; }
        #reporteForm .form-control, #reporteForm .form-select { border-radius: 8px; }
        #contenedorCheckboxes .form-check { background-color: #ffffff; padding: 10px 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); min-width: 120px; text-align: center; }
        #contenedorCheckboxes { justify-content: flex-start; gap: 15px; } /* Aumentado gap para evitar pisadas */
        #tablaCuerpo td { vertical-align: middle; }
        .search-input { max-width: 300px; }

        /* Modal Flota */
        #modalFlota .modal-content { border-radius: 15px; }
        #panelAccionAdmin { border-radius: 10px; }
    </style>
</head>
<body>

<div id="pantalla-login">
    <div class="card shadow card-login p-4 bg-white">
        <h3 class="text-center mb-4"><i class="fas fa-lock me-2"></i>Control de Flota</h3>
        <div class="d-grid gap-3">
            <button onclick="intentarLogin('reportador')" class="btn btn-outline-primary btn-lg"><i class="fas fa-file-alt me-2"></i>Soy Reportador</button>
            <button onclick="intentarLogin('tecnico')" class="btn btn-outline-success btn-lg"><i class="fas fa-tools me-2"></i>Soy T√©cnico</button>
            <button onclick="intentarLogin('supervisor')" class="btn btn-outline-dark btn-lg"><i class="fas fa-user-shield me-2"></i>Soy Supervisor</button>
        </div>
    </div>
</div>

<div id="pantalla-app" class="container mt-4 mb-5">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="fas fa-tools me-2"></i>Sistema de Reportes</h2>
            <span class="badge bg-secondary" id="badgeRolUsuario">Rol: --</span>
        </div>
        <div>
            <button id="btnAdminFlota" onclick="abrirModalFlota()" class="btn btn-warning me-2" style="display:none;"><i class="fas fa-cogs me-2"></i>Gestionar Flota</button>
            <button onclick="cerrarSesion()" class="btn btn-sm btn-outline-danger"><i class="fas fa-sign-out-alt me-2"></i>Salir</button>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white"><h5 class="mb-0"><i class="fas fa-plus me-2"></i>Nuevo Reporte</h5></div>
        <div class="card-body">
            <form id="reporteForm">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">1. Grupo</label>
                        <select class="form-select" id="selectorGrupo" onchange="cargarUnidades('principal')" required>
                            <option value="">-- Seleccionar --</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">2. Unidad</label>
                        <select class="form-select" id="selectorUnidad" onchange="cargarOpcionesFalla()" disabled required>
                            <option value="">-- Primero elija grupo --</option>
                        </select>
                        <small id="avisoBaja" class="text-danger fw-bold mt-1" style="display:none;"><i class="fas fa-exclamation-triangle me-1"></i>Esta unidad est√° dada de BAJA</small>
                    </div>
                </div>
                <div class="mb-3 p-3 bg-light border rounded" id="panelFallas" style="display:none;">
                    <label class="form-label fw-bold text-danger">3. Fallas:</label>
                    <div id="contenedorCheckboxes" class="d-flex flex-wrap"></div> <!-- Quitado gap-3, manejado en CSS -->
                </div>
                <div class="mb-3"><textarea id="observaciones" class="form-control" rows="3" placeholder="Observaciones..."></textarea></div>
                <button type="submit" class="btn btn-success w-100 fw-bold"><i class="fas fa-paper-plane me-2"></i>Enviar Reporte</button>
            </form>
        </div>
    </div>

    <div class="card shadow">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Tablero de Control</h5>
            <div class="input-group input-group-sm search-input">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" id="busquedaTabla" class="form-control" placeholder="Buscar por unidad o falla...">
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0 text-center align-middle" id="tablaReportes">
                    <thead class="table-secondary sticky-top">
                        <tr>
                            <th>Unidad <i class="fas fa-sort ms-1" onclick="ordenarTabla(0)"></i></th>
                            <th>Fallas</th>
                            <th>Fecha <i class="fas fa-sort ms-1" onclick="ordenarTabla(2)"></i></th>
                            <th>Estado <i class="fas fa-sort ms-1" onclick="ordenarTabla(3)"></i></th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCuerpo"></tbody>
                </table>
            </div>
            <div id="loading" class="text-center p-3 text-muted"><div class="spinner-border spinner-border-sm"></div> Conectando...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toastNotificacion" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Notificaci√≥n</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body"></div>
        </div>
    </div>

    <!-- Modal para Observaciones -->
    <div class="modal fade" id="modalObservaciones" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Observaciones</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalContenido"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Flota (ya existente, mejorado) -->
    <div class="modal fade" id="modalFlota" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title fw-bold"><i class="fas fa-cogs me-2"></i>Gestionar Estado de Unidades</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Seleccione una unidad para Dar de Baja o Rehabilitar.</p>
                    <div class="mb-3">
                        <label>Grupo:</label>
                        <select class="form-select" id="adminSelectorGrupo" onchange="cargarUnidades('admin')">
                            <option value="">-- Seleccionar --</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label>Unidad:</label>
                        <select class="form-select" id="adminSelectorUnidad" onchange="verificarEstadoAdmin()">
                            <option value="">-- Seleccionar Unidad --</option>
                        </select>
                    </div>
                    
                    <div id="panelAccionAdmin" class="text-center p-3 border rounded bg-light" style="display:none;">
                        <h4 id="lblEstadoActual" class="mb-3"></h4>
                        <button id="btnCambiarEstado" onclick="cambiarEstadoUnidad()" class="btn w-100"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, update, remove, onChildAdded, onChildChanged, onChildRemoved, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDVeuhJt3jdlkGcLr0nvuJA4qZldZp0eXw",
        authDomain: "gestionflota-ea461.firebaseapp.com",
        databaseURL: "https://gestionflota-ea461-default-rtdb.firebaseio.com",
        projectId: "gestionflota-ea461",
        storageBucket: "gestionflota-ea461.firebasestorage.app",
        messagingSenderId: "43528636288",
        appId: "1:43528636288:web:c8a9f3f740bcfb7e856365"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, 'reparaciones');
    const dbFlotaRef = ref(db, 'estado_flota'); // Nueva referencia para estados

    let rolActual = ""; 
    let mapaBajas = {}; // Aqu√≠ guardaremos qu√© unidades est√°n de baja

    // --- LOGIN ---
    window.intentarLogin = function(rol) {
        let pass = null;
        if (rol === 'tecnico') {
            pass = prompt("Clave T√©cnico:");
            if (pass !== "1234") { mostrarToast('Clave incorrecta', 'danger'); return; }
        } else if (rol === 'supervisor') {
            pass = prompt("Clave Supervisor:");
            if (pass !== "admin") { mostrarToast('Clave incorrecta', 'danger'); return; }
        }
        iniciarApp(rol.charAt(0).toUpperCase() + rol.slice(1)); // Capitalizar rol
    };

    function iniciarApp(rolNombre) {
        rolActual = rolNombre;
        document.getElementById('pantalla-login').style.display = 'none';
        document.getElementById('pantalla-app').style.display = 'block';
        document.getElementById('badgeRolUsuario').innerText = "Rol: " + rolActual;
        
        // Mostrar bot√≥n admin solo a Supervisor
        if(rolActual === 'Supervisor') {
            document.getElementById('btnAdminFlota').style.display = 'block';
        }

        activarEscuchasFirebase();
    }
    window.cerrarSesion = function() { location.reload(); };

    // --- CONFIG FLOTA ---
    const configFlota = [
        { label: "Serie 0100 (0104-0186)", min: 104, max: 186, caps: ["GPS"] },
        { label: "Serie 1000 A (1016-1081)", min: 1016, max: 1081, caps: ["GPS", "RFID", "Censado", "NVR"] },
        { label: "Serie 1100 (1121-1150)", min: 1121, max: 1150, caps: ["GPS", "NVR"] },
        { label: "Serie 1200 (1204-1235)", min: 1204, max: 1235, caps: ["GPS", "Censado"] },
        { label: "Serie 1300 (1304-1312)", min: 1304, max: 1312, caps: ["GPS"] },
        { label: "Serie 1400 (1407-1421)", min: 1407, max: 1421, caps: ["GPS"] },
        { label: "Serie 1600 (1604-1610)", min: 1604, max: 1610, caps: ["GPS", "RFID", "Censado"] },
        { label: "Serie 1700 (1704-1727)", min: 1704, max: 1727, caps: ["GPS", "Censado", "NVR"] },
        { label: "Serie 1900 (1902-1927)", min: 1902, max: 1927, caps: ["GPS", "NVR"] },
        { label: "Especial (1950)", min: 1950, max: 1950, caps: ["GPS"] }
    ];

    // Llenar selects de grupos (Principal y Admin)
    const selectGrupo = document.getElementById('selectorGrupo');
    const adminSelectGrupo = document.getElementById('adminSelectorGrupo');
    configFlota.forEach((grupo, index) => {
        let opt = new Option(grupo.label, index);
        selectGrupo.appendChild(opt);
        adminSelectGrupo.appendChild(opt.cloneNode(true));
    });

    // --- L√ìGICA DE CARGA DE UNIDADES ---
    window.cargarUnidades = function(tipo) {
        // 'tipo' puede ser 'principal' (formulario) o 'admin' (modal)
        const idSelectorGrupo = tipo === 'principal' ? 'selectorGrupo' : 'adminSelectorGrupo';
        const idSelectorUnidad = tipo === 'principal' ? 'selectorUnidad' : 'adminSelectorUnidad';
        
        const index = document.getElementById(idSelectorGrupo).value;
        const selectUnidad = document.getElementById(idSelectorUnidad);
        
        selectUnidad.innerHTML = '<option value="">-- Seleccionar --</option>';
        if(tipo === 'principal') {
            document.getElementById('panelFallas').style.display = 'none';
            document.getElementById('avisoBaja').style.display = 'none';
        } else {
            document.getElementById('panelAccionAdmin').style.display = 'none';
        }

        if (index === "") { selectUnidad.disabled = true; return; }
        
        const grupo = configFlota[index]; 
        selectUnidad.disabled = false;

        for (let i = grupo.min; i <= grupo.max; i++) {
            let opt = document.createElement('option');
            let num = i.toString().padStart(4, '0');
            opt.value = num;
            
            // VERIFICAR SI EST√Å DE BAJA (Usando el mapa descargado de Firebase)
            let estaDeBaja = mapaBajas[num] === true;

            if (tipo === 'principal') {
                // En el form principal, si est√° de baja, se deshabilita
                if (estaDeBaja) {
                    opt.text = `${num} (FUERA DE SERVICIO)`;
                    opt.disabled = true;
                    opt.classList.add('fuera-servicio');
                } else {
                    opt.text = num;
                }
            } else {
                // En el admin, mostramos el estado pero dejamos seleccionar para cambiarlo
                if (estaDeBaja) {
                    opt.text = `${num} üî¥ BAJA`;
                    opt.style.color = 'red';
                } else {
                    opt.text = `${num} üü¢ OK`;
                }
            }
            selectUnidad.appendChild(opt);
        }
    }

    // --- CARGA DE FALLAS (Formulario Principal) ---
    window.cargarOpcionesFalla = function() {
        const index = document.getElementById('selectorGrupo').value;
        const contenedor = document.getElementById('contenedorCheckboxes');
        const panel = document.getElementById('panelFallas');
        if (index === "") return;
        contenedor.innerHTML = ''; panel.style.display = 'block';
        configFlota[index].caps.forEach(cap => {
            let div = document.createElement('div');
            div.className = 'form-check form-switch';
            div.innerHTML = `<input class="form-check-input" type="checkbox" name="fallas" value="${cap}" id="chk_${cap}"><label class="form-check-label" for="chk_${cap}">${cap}</label>`;
            contenedor.appendChild(div);
        });
    }

    // --- GESTI√ìN DE ESTADO (SUPERVISOR) ---
    window.abrirModalFlota = function() {
        new bootstrap.Modal(document.getElementById('modalFlota')).show();
    };

    window.verificarEstadoAdmin = function() {
        const unidad = document.getElementById('adminSelectorUnidad').value;
        if(!unidad) { document.getElementById('panelAccionAdmin').style.display = 'none'; return; }

        document.getElementById('panelAccionAdmin').style.display = 'block';
        const lbl = document.getElementById('lblEstadoActual');
        const btn = document.getElementById('btnCambiarEstado');

        if(mapaBajas[unidad] === true) {
            lbl.innerText = `Unidad ${unidad}: FUERA DE SERVICIO üî¥`;
            lbl.className = "mb-3 text-danger fw-bold";
            btn.innerText = "‚úÖ REHABILITAR UNIDAD";
            btn.className = "btn btn-success w-100";
            btn.onclick = function() { toggleBaja(unidad, false); };
        } else {
            lbl.innerText = `Unidad ${unidad}: OPERATIVA üü¢`;
            lbl.className = "mb-3 text-success fw-bold";
            btn.innerText = "üö´ DAR DE BAJA";
            btn.className = "btn btn-danger w-100";
            btn.onclick = function() { toggleBaja(unidad, true); };
        }
    };

    function toggleBaja(unidad, darDeBaja) {
        // Guardamos en Firebase: estado_flota/1020 = true (Baja) o null (Alta)
        const refUnidad = ref(db, `estado_flota/${unidad}`);
        if(darDeBaja) {
            set(refUnidad, true).then(() => {
                mostrarToast(`Unidad ${unidad} dada de BAJA`, 'success');
            }).catch(err => mostrarToast('Error: ' + err.message, 'danger'));
        } else {
            remove(refUnidad).then(() => {
                mostrarToast(`Unidad ${unidad} REHABILITADA`, 'success');
            }).catch(err => mostrarToast('Error: ' + err.message, 'danger'));
        }
        // Actualizar UI del modal
        setTimeout(() => {
            cargarUnidades('admin'); // Recargar lista del modal
            document.getElementById('adminSelectorUnidad').value = unidad; // Mantener selecci√≥n
            verificarEstadoAdmin(); // Refrescar panel
            cargarUnidades('principal'); // Refrescar lista del form principal
        }, 500);
    }

    // --- ENVIAR REPORTE CON VALIDACI√ìN ---
    document.getElementById('reporteForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const unidad = document.getElementById('selectorUnidad').value;
        const obs = document.getElementById('observaciones').value.trim();
        const checkboxes = document.querySelectorAll('input[name="fallas"]:checked');
        if (!unidad) { mostrarToast('Seleccione una unidad v√°lida.', 'danger'); return; }
        if (checkboxes.length === 0) { mostrarToast('Seleccione al menos una falla.', 'danger'); return; }
        let listaFallas = Array.from(checkboxes).map(cb => cb.value);
        
        push(dbRef, {
            unidad: unidad, fallas: listaFallas, observaciones: obs,
            fecha: new Date().toLocaleDateString('es-AR'), hora: new Date().toLocaleTimeString('es-AR'),
            estado: "Pendiente", usuario: rolActual
        }).then(() => {
            mostrarToast('Reporte enviado exitosamente.', 'success');
            document.getElementById('reporteForm').reset();
            document.getElementById('panelFallas').style.display = 'none';
            document.getElementById('selectorUnidad').disabled = true;
            document.getElementById('selectorUnidad').innerHTML = '<option value="">-- Primero elija grupo --</option>';
        }).catch(err => mostrarToast('Error al enviar reporte: ' + err.message, 'danger'));
    });

    // --- LISTENERS ---
    window.marcarCompletado = function(id) { 
        if(confirm("¬øReparaci√≥n completada?")) {
            update(ref(db, 'reparaciones/' + id), { estado: "Completado", fechaResolucion: new Date().toLocaleDateString('es-AR') })
                .then(() => mostrarToast('Reporte marcado como completado.', 'success'))
                .catch(err => mostrarToast('Error: ' + err.message, 'danger'));
        }
    };
    window.eliminarReporte = function(id) { 
        if(confirm("¬øEliminar reporte?")) {
            remove(ref(db, 'reparaciones/' + id))
                .then(() => mostrarToast('Reporte eliminado.', 'success'))
                .catch(err => mostrarToast('Error: ' + err.message, 'danger'));
        }
    };

    window.mostrarObservaciones = function(obs) {
        document.getElementById('modalContenido').innerText = obs || 'Sin observaciones.';
        new bootstrap.Modal(document.getElementById('modalObservaciones')).show();
    };

    function activarEscuchasFirebase() {
        document.getElementById('tablaCuerpo').innerHTML = "";
        
        // 1. ESCUCHAR ESTADO DE FLOTA (BAJAS)
        onValue(dbFlotaRef, (snapshot) => {
            mapaBajas = snapshot.val() || {}; // Actualizar variable local
            // Si el admin tiene abierto el form principal, recargar para que se pongan grises
            if(document.getElementById('selectorGrupo').value !== "") {
                cargarUnidades('principal');
            }
        });

        // 2. ESCUCHAR REPORTES
        onChildAdded(dbRef, (snap) => { document.getElementById('loading').style.display='none'; crearFila(snap.key, snap.val()); });
        onChildChanged(dbRef, (snap) => { 
            let f = document.getElementById(snap.key); if(f) f.remove(); crearFila(snap.key, snap.val()); 
        });
        onChildRemoved(dbRef, (snap) => { let f = document.getElementById(snap.key); if(f) f.remove(); });
    }

    function crearFila(key, data) {
        let badges = (data.fallas||[]).map(f => {
            let c = f==='GPS'?'bg-danger':f==='RFID'?'bg-warning text-dark':f==='NVR'?'bg-info text-dark':'bg-success';
            return `<span class="badge ${c} badge-falla">${f}</span>`;
        }).join('');
        
        let acciones = `<button onclick="mostrarObservaciones('${data.observaciones.replace(/'/g, "\\'")}')" class="btn btn-sm btn-info me-1" title="Ver Observaciones"><i class="fas fa-eye"></i></button>`;
        if (rolActual === 'T√©cnico' || rolActual === 'Supervisor') {
            if (data.estado !== "Completado") acciones += `<button onclick="marcarCompletado('${key}')" class="btn btn-sm btn-success me-1" title="Completado"><i class="fas fa-check"></i></button>`;
            if (rolActual === 'Supervisor') acciones += `<button onclick="eliminarReporte('${key}')" class="btn btn-sm btn-danger" title="Eliminar"><i class="fas fa-trash"></i></button>`;
        }
        
        let colorFila = data.estado === "Completado" ? "table-success" : "";
        let estadoTxt = data.estado === "Completado" ? `<span class="badge bg-success"><i class="fas fa-check me-1"></i>Listo</span>` : `<span class="badge bg-secondary">Pendiente</span>`;

        const html = `<tr id="${key}" class="${colorFila}"><td class="fw-bold">${data.unidad}</td><td>${badges}</td><td>${data.fecha}<br><small>${data.hora}</small></td><td>${estadoTxt}</td><td>${acciones}</td></tr>`;
        document.getElementById('tablaCuerpo').insertAdjacentHTML('afterbegin', html);
    }

    // --- FUNCIONALIDADES ADICIONALES ---
    // B√∫squeda en tabla
    document.getElementById('busquedaTabla').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const rows = document.querySelectorAll('#tablaCuerpo tr');
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });

    // Ordenar tabla
    let ordenAsc = true;
    window.ordenarTabla = function(colIndex) {
        const table = document.getElementById('tablaReportes');
        const rows = Array.from(table.tBodies[0].rows);
        rows.sort((a, b) => {
            let valA = a.cells[colIndex].textContent.trim();
            let valB = b.cells[colIndex].textContent.trim();
            if (colIndex === 2) { // Fecha
                valA = new Date(valA.split('/').reverse().join('-'));
                valB = new Date(valB.split('/').reverse().join('-'));
            } else if (colIndex === 3) { // Estado
                valA = valA.includes('Pendiente') ? 0 : 1;
                valB = valB.includes('Pendiente') ? 0 : 1;
            }
            return ordenAsc ? (valA > valB ? 1 : -1) : (valA < valB ? 1 : -1);
        });
        ordenAsc = !ordenAsc;
        rows.forEach(row => table.tBodies[0].appendChild(row));
    };

    // Mostrar Toast
    function mostrarToast(mensaje, tipo = 'info') {
        const toastEl = document.getElementById('toastNotificacion');
        const toastBody = toastEl.querySelector('.toast-body');
        toastBody.textContent = mensaje;
        toastEl.classList.remove('text-bg-success', 'text-bg-danger', 'text-bg-info');
        if (tipo === 'success') toastEl.classList.add('text-bg-success');
        else if (tipo === 'danger') toastEl.classList.add('text-bg-danger');
        else toastEl.classList.add('text-bg-info');
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
    }
</script>
</body>
</html>